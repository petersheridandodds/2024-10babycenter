more off;

%% shows what happens moving away from one year 

filename1s = {
    '../data/Control_for_MemoryLoss_Full_Exploratory_word_shift_freqs.tsv',
 ...
    '../data/Control_for_MemoryLoss_Age_Matched_Exploratory_word_shift_freqs.tsv',
    '../data/Control_for_MemoryLoss_Full_Exploratory_word_shift_freqs.tsv',
    '../data/Control_for_MemoryLoss_Full_Exploratory_word_shift_freqs.tsv',
             };
    
filename2s = {
    '../data/MemoryLoss_Full_Exploratory_word_shift_freqs.tsv',
    '../data/MemoryLoss_Age_Matched_Exploratory_word_shift_freqs.tsv',
    '../../2021-04radiotalk/data/radiotalk_fulldist.txt';
    '../../2021-04radiotalk/data/radiotalk_fulldist_lc.txt';
    };
    
corpusname1s = {
    'StoryCorps Control: Full',
    'StoryCorps Control: Age matched',
    'StoryCorps Control: Full',
    'StoryCorps Control: Full',
               };

corpusname2s = {
    'StoryCorps Memory Loss: Full',
    'StoryCorps Memory Loss: Age matched',
    'RadioTalk (case presereved)', %% demo of error
    'RadioTalk (lowercase)',
              };

for loop_i = 1:length(filename1s)
    filename1 = filename1s{loop_i};
    filename2 = filename2s{loop_i};

    %%    opts = detectImportOptions(filename1,
    data1 = importdata(filename1,'\t');
    data2 = importdata(filename2,'\t');
    
    j=1;
    elements(j).types = data1(1).textdata;
    elements(j).counts = data1(1).data;
    elements(j).probs = data1(1).data/sum(data1(1).data);
    elements(j).ranks = tiedrank(-data1(1).data);
    elements(j).totalunique = length(data1(1).data);

    j=2;
    elements(j).types = data2(1).textdata;
    elements(j).counts = data2(1).data;
    elements(j).probs = data2(1).data/sum(data2(1).data);
    elements(j).ranks = tiedrank(-data2(1).data);
    elements(j).totalunique = length(data2(1).data);
    
    mixedelements = combine_distributions(elements(1),elements(2));

    settings.imageformat.open = 'no';
    settings.maxrank_log10 = 5.5;
    settings.maxcount_log10 = 4;

    settings.more_string = {'more','frequent'};
    settings.less_string = {'less','frequent'};
    
    settings.typename = 'word';
    settings.units = 'counts';

    settings.topNshuffling = 25;
    settings.topNshift = 40;
    settings.topNdeltasum = 'all';

    settings.xoffset = +0.05;

    settings.max_plot_string_length = 20;
    settings.max_shift_string_length = 25;


    fprintf(1,'constructing figure ...\n');

    settings.system1_name = corpusname1s{loop_i};
    settings.system2_name = corpusname2s{loop_i};

    %%%%%%%%%%%%
    %% rtd
    %%%%%%%%%%%%
    
    alphavals = [(0:18)/12, 2, 3, 5, 10, Inf];

    settings.axislabel_top1 = 'Word use rank $r$';
    settings.axislabel_top2 = 'Word use rank $r$';

    settings.plotkind = 'rank';
    settings.instrument = 'rank divergence';
    
    for loop_j = 1:0 %% length(alphavals)
        settings.alpha = alphavals(loop_j);
        %% settings.alpha = 1/3;
        %% settings.alpha = 1/2;
        %% settings.alpha = 5/6;

        tag = sprintf('story_corps_memory001-rtd-%02d-alpha%02d',loop_i,loop_j);

        figallotaxonometer9000(mixedelements,tag,settings);
    
    end    

    %%%%%%%%%%%%
    %% ptd
    %%%%%%%%%%%%
    
    alphavals = [(0:18)/12, 2, 3, 5, 10, Inf];

    settings.axislabel_top1 = 'Normalized frequency $p$';
    settings.axislabel_top2 = 'Normalized frequency $p$';

    settings.plotkind = 'probability';
    settings.instrument = 'probability divergence';
    
    for loop_j = 1:length(alphavals)
        settings.alpha = alphavals(loop_j);
        %% settings.alpha = 1/3;
        %% settings.alpha = 1/2;
        %% settings.alpha = 5/6;

        tag = sprintf('story_corps_memory001-ptd-%02d-alpha%02d',loop_i,loop_j);

        figallotaxonometer9000(mixedelements,tag,settings);
    
    end    
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

end


more on;

%% create flipbooks

!combinepdfs figallotaxonometer9000/figallotaxonometer9000-story_corps_memory001-rtd-01-alpha??_noname.pdf flipbooks/figallotaxonometer9000-story_corps_memory001-rtd-01-flipbook.pdf

!combinepdfs figallotaxonometer9000/figallotaxonometer9000-story_corps_memory001-rtd-02-alpha??_noname.pdf flipbooks/figallotaxonometer9000-story_corps_memory001-rtd-02-flipbook.pdf

!combinepdfs figallotaxonometer9000/figallotaxonometer9000-story_corps_memory001-ptd-01-alpha??_noname.pdf flipbooks/figallotaxonometer9000-story_corps_memory001-ptd-01-flipbook.pdf

!combinepdfs figallotaxonometer9000/figallotaxonometer9000-story_corps_memory001-ptd-02-alpha??_noname.pdf flipbooks/figallotaxonometer9000-story_corps_memory001-ptd-02-flipbook.pdf


